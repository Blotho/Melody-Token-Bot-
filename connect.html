<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLT News Bot — TonConnect</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;background:#fafafa}
  .wrap{max-width:720px;margin:0 auto}
  h1{margin:0 0 12px;font-size:32px}
  .card{background:#fff;border:1px solid #e7e7e7;border-radius:12px;padding:16px}
  p{margin:10px 0 16px;line-height:1.45;color:#222}
  #status{margin-top:12px;color:#0a0}
  .btn{display:inline-block;padding:10px 16px;border-radius:10px;border:1px solid #1b78ff;color:#1b78ff;background:#fff;cursor:pointer}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Подключение кошелька</h1>
    <div class="card">
      <p>Нажмите кнопку ниже, выберите кошелёк (Tonkeeper, Wallet in Telegram и др.) и подтвердите подключение.</p>
      <div id="connect" style="margin-bottom:8px;"></div>
      <button class="btn" onclick="openWallet()">Подключить кошелёк</button>
      <p id="status">Ожидаем подключение…</p>
    </div>
  </div>

  <!-- UMD-версия (без modules) -->
  <script src="https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.7/dist/tonconnect-ui.umd.js"></script>
  <script>
    const manifestUrl = 'https://blotho.github.io/Melody-Token-Bot-/tonconnect-manifest.json';
    const TonUI = window.TonConnectUI;
    const ui = new TonUI.TonConnectUI({ manifestUrl });

    ui.mount('#connect');

    window.openWallet = async () => {
      try { await ui.openModal(); }
      catch { location.href = 'https://app.tonkeeper.com/ton-connect?manifestUrl='+encodeURIComponent(manifestUrl); }
    };

    setTimeout(async()=>{ try{ if(!(await ui.getWallet())) await ui.openModal(); }catch{} },200);

    ui.onStatusChange(w=>{
      if(w?.account?.address){
        const a=w.account.address;
        document.getElementById('status').textContent = `✅ Подключено: ${a.slice(0,4)}…${a.slice(-4)}. Можно вернуться в Telegram.`;
      }
    });
  </script>
</body>
</html>
